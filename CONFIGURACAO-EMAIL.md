# ğŸ“§ ConfiguraÃ§Ã£o de E-mail (Gmail)

Este guia mostra como configurar o envio de emails automÃ¡ticos usando Gmail.

## âœ… Passo 1: Configurar Senha de Aplicativo no Gmail

### Por que preciso de uma "Senha de aplicativo"?
O Gmail nÃ£o permite que aplicativos usem sua senha normal por seguranÃ§a. VocÃª precisa gerar uma senha especial para o aplicativo.

### ğŸ¯ MÃ‰TODO MAIS FÃCIL - Link Direto:

**ğŸ‘‰ Acesse diretamente:** https://myaccount.google.com/apppasswords

Se o link acima nÃ£o funcionar, siga o mÃ©todo manual abaixo.

---

### ğŸ“‹ Passo a Passo Detalhado:

#### **1ï¸âƒ£ Ativar VerificaÃ§Ã£o em 2 Etapas (ObrigatÃ³rio)**

ğŸ”— **Link direto:** https://myaccount.google.com/signinoptions/twosv

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Google Account > SeguranÃ§a             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ğŸ” VerificaÃ§Ã£o em duas etapas         â”‚
â”‚                                         â”‚
â”‚  [ ComeÃ§ar ]  â† Clique aqui            â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Clique em **"ComeÃ§ar"**
- Confirme sua senha do Gmail
- Adicione seu telefone (vai receber um SMS)
- Digite o cÃ³digo que recebeu
- Clique em **"Ativar"**

âœ… **Pronto!** A verificaÃ§Ã£o estÃ¡ ativa.

---

#### **2ï¸âƒ£ Gerar Senha de Aplicativo**

ğŸ”— **Link direto:** https://myaccount.google.com/apppasswords

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Senhas de app                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Digite o nome do app:                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Shoe Repair API   â”‚  â† Digite aqui â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                         â”‚
â”‚            [ Criar ]                    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. Na caixa de texto, digite: **Shoe Repair API**
2. Clique em **"Criar"**
3. Uma senha de 16 caracteres vai aparecer:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sua senha de app                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚     abcd efgh ijkl mnop                â”‚
â”‚                                         â”‚
â”‚  [ Copiar ] [ Concluir ]               â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

4. **Clique em "Copiar"** (ou copie manualmente: `abcdefghijklmnop` - sem espaÃ§os!)
5. **Cole em algum lugar seguro** (bloco de notas, por exemplo)

âš ï¸ **ATENÃ‡ÃƒO:** Depois que vocÃª clicar "Concluir", essa senha nÃ£o aparece mais! Se perder, precisa gerar outra.

---

#### **3ï¸âƒ£ Remover os EspaÃ§os da Senha**

A senha que vocÃª copiou tem espaÃ§os: `abcd efgh ijkl mnop`

**VocÃª precisa remover os espaÃ§os:** `abcdefghijklmnop`

ğŸ’¡ **Dica:** Cole no Notepad e apague os espaÃ§os manualmente.

---

### â“ Problemas Comuns ao Gerar Senha

#### **ğŸš« "Senhas de app nÃ£o estÃ¡ disponÃ­vel"**
- **Causa:** VerificaÃ§Ã£o em 2 etapas nÃ£o estÃ¡ ativa
- **SoluÃ§Ã£o:** Volte ao passo 1ï¸âƒ£ e ative primeiro

#### **ğŸš« PÃ¡gina dÃ¡ erro ou nÃ£o carrega**
- **Causa:** VocÃª pode estar usando conta Google Workspace (empresa/escola)
- **SoluÃ§Ã£o:** Use uma conta Gmail pessoal, ou peÃ§a ao administrador da empresa

#### **ğŸš« "Senha incorreta" ao testar**
- **Causa:** VocÃª copiou com espaÃ§os ou usou a senha normal do Gmail
- **SoluÃ§Ã£o:** Use a senha de 16 caracteres **SEM ESPAÃ‡OS**

---

### ğŸ¥ Precisa de ajuda visual?

Se mesmo assim tiver dÃºvida, vocÃª pode:
1. Procurar no YouTube: "Como gerar senha de aplicativo Gmail 2024"
2. Ou seguir este guia oficial do Google: https://support.google.com/accounts/answer/185833

---

## âœ… Passo 2: Configurar o arquivo .env

1. **Crie o arquivo `.env`** na raiz do projeto (se nÃ£o existir):
   ```bash
   # No PowerShell, na raiz do projeto:
   New-Item -Path .env -ItemType File
   ```

2. **Adicione as configuraÃ§Ãµes de email:**
   ```env
   # ==========================================
   # CONFIGURAÃ‡ÃƒO DE E-MAIL (Gmail)
   # ==========================================
   
   # Seu email do Gmail (que enviarÃ¡ os emails)
   GMAIL_USER=seu-email@gmail.com
   
   # Senha de aplicativo gerada no passo anterior
   # Exemplo: abcd efgh ijkl mnop (remover espaÃ§os)
   GMAIL_APP_PASSWORD=abcdefghijklmnop
   
   # ==========================================
   # AWS CONFIGURATION
   # ==========================================
   
   AWS_REGION=us-east-1
   
   # DynamoDB Tables
   DYNAMODB_TABLE_CLIENTES=shoe-repair-clientes
   DYNAMODB_TABLE_PEDIDOS=shoe-repair-pedidos
   DYNAMODB_TABLE_USERS=shoe-repair-users
   
   # S3 para PDFs e fotos
   S3_BUCKET_NAME=shoe-repair-pdfs
   S3_REGION=us-east-1
   
   # JWT Authentication
   JWT_SECRET=your-jwt-secret-key-here-change-this-in-production
   JWT_EXPIRES_IN=24h
   
   # WhatsApp API (Evolution API)
   WHATSAPP_API_URL=http://seu-servidor:8080
   WHATSAPP_API_KEY=sua-chave-api
   WHATSAPP_INSTANCE_NAME=sua-instancia
   ```

3. **Substitua os valores:**
   - `seu-email@gmail.com` â†’ Seu email real do Gmail
   - `abcdefghijklmnop` â†’ A senha de aplicativo que vocÃª copiou (sem espaÃ§os)

---

## âœ… Passo 3: Verificar se estÃ¡ funcionando

### Teste local:
```bash
# 1. Certifique-se de que o .env estÃ¡ configurado
# 2. Inicie o servidor localmente
npm start

# 3. Crie um pedido de teste via API
# O email de confirmaÃ§Ã£o deve ser enviado automaticamente
```

### Quando os emails sÃ£o enviados:
1. **CriaÃ§Ã£o de pedido** â†’ Email de confirmaÃ§Ã£o
2. **AtualizaÃ§Ã£o de status** â†’ Email de notificaÃ§Ã£o
3. **Pedido finalizado** â†’ Email de conclusÃ£o

---

## ğŸ” Troubleshooting (ResoluÃ§Ã£o de Problemas)

### âŒ Erro: "Invalid login"
- Verifique se a **VerificaÃ§Ã£o em Duas Etapas** estÃ¡ ativa
- Confirme que vocÃª estÃ¡ usando a **Senha de Aplicativo**, nÃ£o sua senha normal
- A senha de aplicativo nÃ£o deve conter espaÃ§os

### âŒ Erro: "Too many login attempts"
- O Gmail pode bloquear temporariamente por tentativas demais
- Aguarde 10-15 minutos e tente novamente
- Verifique se vocÃª estÃ¡ usando o email correto

### âŒ Emails nÃ£o estÃ£o sendo enviados
- Verifique os logs do servidor para mensagens de erro
- Confirme que o arquivo `.env` estÃ¡ na raiz do projeto
- Certifique-se de que o `GMAIL_USER` e `GMAIL_APP_PASSWORD` estÃ£o corretos
- Verifique se os clientes tÃªm email cadastrado no sistema

### â„¹ï¸ Ver logs de email:
Os logs aparecem no console com prefixo `[Email/Nodemailer]`:
```
[Email/Nodemailer] E-mail enviado para cliente@email.com
```

---

## ğŸš€ Deploy na AWS Lambda

Quando fizer deploy na AWS, as variÃ¡veis de ambiente devem ser configuradas:

### Via AWS Console:
1. Acesse sua funÃ§Ã£o Lambda
2. VÃ¡ em **"Configuration" â†’ "Environment variables"**
3. Adicione:
   - `GMAIL_USER`: seu-email@gmail.com
   - `GMAIL_APP_PASSWORD`: sua-senha-de-aplicativo

### Via serverless.yml:
```yaml
provider:
  environment:
    GMAIL_USER: ${env:GMAIL_USER}
    GMAIL_APP_PASSWORD: ${env:GMAIL_APP_PASSWORD}
```

---

## ğŸ“§ Exemplo de Email Enviado

**Assunto:** âœ… Pedido #1001 - ConfirmaÃ§Ã£o de Recebimento

**Corpo:**
```
OlÃ¡ JoÃ£o Silva,

Recebemos seu pedido com sucesso! JÃ¡ estamos preparando tudo para cuidar do seu tÃªnis.

ğŸ“¦ Detalhes do Pedido
- CÃ³digo: #1001
- TÃªnis: Nike Air Max
- ServiÃ§os: Limpeza Profunda, HidrataÃ§Ã£o de Couro

VocÃª receberÃ¡ atualizaÃ§Ãµes por email sempre que o status do seu pedido mudar.

Obrigado pela confianÃ§a! ğŸ™
```

---

## ğŸ”’ SeguranÃ§a

- âš ï¸ **NUNCA** commite o arquivo `.env` no Git
- O `.gitignore` jÃ¡ estÃ¡ configurado para ignorar `.env`
- Use variÃ¡veis de ambiente em produÃ§Ã£o
- A senha de aplicativo Ã© especÃ­fica para este app, nÃ£o compromete sua conta Gmail

---

## âœ… Checklist Final

- [ ] VerificaÃ§Ã£o em Duas Etapas ativada no Gmail
- [ ] Senha de aplicativo gerada e copiada
- [ ] Arquivo `.env` criado na raiz do projeto
- [ ] `GMAIL_USER` configurado com email correto
- [ ] `GMAIL_APP_PASSWORD` configurado com senha de aplicativo (sem espaÃ§os)
- [ ] Testado criando um pedido
- [ ] Email de confirmaÃ§Ã£o recebido

---

## ğŸ’¡ Alternativas Futuras

O projeto estÃ¡ preparado para usar **AWS SES** (Amazon Simple Email Service) no futuro, que Ã© mais adequado para produÃ§Ã£o:
- Custos muito baixos ($0.10 por 1000 emails)
- Maior confiabilidade
- MÃ©tricas de entrega
- JÃ¡ tem cÃ³digo preparado no `emailService.js`

Para isso, basta configurar as variÃ¡veis `SES_FROM_EMAIL` e AWS credentials.
